(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[438],{98292:function(e,t,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/autopilot",function(){return o(61510)}])},61510:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return T}});var a=o(52322),n=o(24928),s=o(6391),i=o.n(s),r=o(2784),l=o(15755),d=o(74881),c=o(14404),u=o(67465),h=o(73621),m=o(2288);let g={set:"",amount:void 0,allowance:void 0,period:void 0,renewWindow:void 0,download:void 0,upload:void 0,storage:void 0,allowRedundantIPs:!1,maxDowntimeHours:void 0,defragThreshold:void 0},w={storage:{type:"number",category:"contracts",title:"Expected storage",description:(0,a.jsx)(a.Fragment,{children:"The amount of storage you would like to rent in TB."}),units:"TB",validation:{required:"required"}},upload:{type:"number",category:"contracts",title:"Expected upload",description:(0,a.jsx)(a.Fragment,{children:"The amount of upload bandwidth you plan to use each period in TB."}),units:"TB/period",validation:{required:"required"}},download:{type:"number",category:"contracts",title:"Expected download",description:(0,a.jsx)(a.Fragment,{children:"The amount of download bandwidth you plan to use each period in TB."}),units:"TB/period",validation:{required:"required"}},allowance:{type:"siacoin",category:"contracts",title:"Allowance",description:(0,a.jsx)(a.Fragment,{children:"The amount of Siacoin you would like to spend for the period."}),decimalsLimitSc:6,validation:{required:"required"}},period:{type:"number",category:"contracts",title:"Period",description:(0,a.jsx)(a.Fragment,{children:"The length of the storage contracts."}),units:"weeks",suggestion:new(i())(6),suggestionTip:"Typically 6 weeks.",validation:{required:"required"}},renewWindow:{type:"number",category:"contracts",title:"Renew window",description:(0,a.jsx)(a.Fragment,{children:"The number of weeks prior to contract expiration that Sia will attempt to renew your contracts."}),units:"weeks",decimalsLimit:6,suggestion:new(i())(2),suggestionTip:"Typically 2 weeks.",validation:{required:"required"}},amount:{type:"number",category:"contracts",title:"Hosts",description:(0,a.jsx)(a.Fragment,{children:"The number of hosts to create contracts with."}),units:"hosts",decimalsLimit:0,suggestion:new(i())(50),suggestionTip:"Typically 50 hosts.",validation:{required:"required"}},set:{type:"text",category:"contracts",title:"Contract set",description:(0,a.jsx)(a.Fragment,{children:"The contract set that autopilot should use. This should typically be the same as the default contract set."}),placeholder:"autopilot",suggestion:"autopilot",suggestionTip:(0,a.jsxs)(a.Fragment,{children:["The default contract set is ",(0,a.jsx)(n.EKh,{children:"autopilot"}),"."]}),validation:{required:"required"}},allowRedundantIPs:{type:"boolean",category:"hosts",title:"Redundant IPs",description:(0,a.jsx)(a.Fragment,{children:"Whether or not to allow forming contracts with multiple hosts in the same IP subnet. The subnets used are /16 for IPv4, and /64 for IPv6."}),suggestion:!1,suggestionTip:"Defaults to off.",validation:{}},maxDowntimeHours:{type:"number",category:"hosts",title:"Max downtime",description:(0,a.jsx)(a.Fragment,{children:"The maximum amount of host downtime that autopilot will tolerate in hours."}),units:"hours",suggestion:new(i())(1440),suggestionTip:"Defaults to 1,440 which is 60 days.",validation:{required:"required"}},defragThreshold:{type:"number",category:"wallet",title:"Defrag threshold",description:(0,a.jsx)(a.Fragment,{children:"The threshold after which autopilot will defrag outputs."}),units:"outputs",suggestion:new(i())(1e3),suggestionTip:"Defaults to 1,000.",validation:{required:"required"}}};var p=o(63955),f=o(92762),x=o(85246),v=o(40121),y=o(41755);function j(){let{openDialog:e}=(0,c.Rh)(),t=(0,h.oe)(),o=(0,h.e$)({config:{swr:{revalidateOnFocus:!1,errorRetryCount:0}}}),{shouldSyncDefaultContractSet:s,setShouldSyncDefaultContractSet:j,syncDefaultContractSet:T}=function(){let[e,t]=(0,f.Z)("v0/autopilot/syncDefaultContractSet",{defaultValue:!0}),o=(0,v.a)({config:{swr:{errorRetryCount:0}}}),s=(0,h.KJ)(),i=(0,r.useCallback)(async t=>{let i=o.data||{default:""};try{e&&t!==i.default&&(await s.put({params:{key:"contractset"},payload:(0,x.y4)({contractSet:t},o.data)}),o.mutate(),(0,n.OPV)((0,a.jsxs)(n.xvT,{children:["Default contract set has been updated to:"," ",(0,a.jsx)(n.EKh,{children:t}),"."]})))}catch(r){(0,n.OHV)(r.message),console.log(r)}},[o.data,s,e]);return{shouldSyncDefaultContractSet:e,setShouldSyncDefaultContractSet:t,syncDefaultContractSet:i}}(),b=(0,p.cI)({mode:"all",defaultValues:g}),k=(0,r.useCallback)(e=>{b.reset(function(e){let t=e.contracts.set,o=(0,m.ll)(e.contracts.allowance,6),a=new(i())(e.contracts.amount),s=new(i())((0,n.x5w)(e.contracts.period)),r=new(i())((0,n.x5w)(e.contracts.renewWindow)),l=(0,n.JWi)(new(i())(e.contracts.download)),d=(0,n.JWi)(new(i())(e.contracts.upload)),c=(0,n.JWi)(new(i())(e.contracts.storage));return{set:t,allowance:o,amount:a,period:s,renewWindow:r,download:l,upload:d,storage:c,allowRedundantIPs:e.hosts.allowRedundantIPs,maxDowntimeHours:new(i())(e.hosts.maxDowntimeHours),defragThreshold:new(i())(e.wallet.defragThreshold)}}(e))},[b]),[q,N]=(0,r.useState)(!1);(0,r.useEffect)(()=>{var e;if(o.data&&!q){k(o.data),N(!0);return}if((null===(e=o.error)||void 0===e?void 0:e.status)===404&&!q){b.reset(g),N(!0);return}},[o.data,o.error]);let C=(0,r.useCallback)(async()=>{let e=await o.mutate();e?k(e):(0,n.OHV)("Error fetching config.")},[o,k]),O=(0,y.Tu)(),P=(0,r.useCallback)(async e=>{try{var a;let s=!o.data;if(await t.put({payload:{...a=o.data,contracts:{...null==a?void 0:a.contracts,set:e.set,amount:Math.round(e.amount.toNumber()),allowance:(0,m.qN)(e.allowance).toString(),period:Math.round((0,n.mvJ)(e.period.toNumber())),renewWindow:Math.round((0,n.mvJ)(e.renewWindow.toNumber())),download:(0,n.xf5)(e.download).toNumber(),upload:(0,n.xf5)(e.upload).toNumber(),storage:(0,n.xf5)(e.storage).toNumber()},hosts:{...null==a?void 0:a.hosts,maxDowntimeHours:e.maxDowntimeHours.toNumber(),allowRedundantIPs:e.allowRedundantIPs,scoreOverrides:(null==a?void 0:a.hosts.scoreOverrides)||null},wallet:{...null==a?void 0:a.wallet,defragThreshold:e.defragThreshold.toNumber()}}}),(0,n.OPV)("Configuration has been saved."),T(e.set),s){let i=async()=>{await (0,y.gw)(5e3),O(e=>e.startsWith(h.pz)),await (0,y.gw)(5e3),O(e=>e.startsWith(h.pz))};i()}C()}catch(r){(0,n.OHV)(r.message),console.log(r)}},[o.data,t,C,T,O]),_=(0,n.WsO)(w),E=(0,r.useMemo)(()=>b.handleSubmit(P,_),[b,P,_]),F=b.watch("storage"),R=b.watch("period"),S=b.watch("allowance"),W=(0,r.useMemo)(()=>!(!F||!R||!S||F.isZero()||R.isZero()||S.isZero()),[F,R,S]),D=(0,r.useMemo)(()=>{if(!W)return new(i())(0);let e=S.div(R),t=e.div(7).times(30);return(0,m.IZ)(t,0)},[W,R,S]),z=Object.entries(b.formState.dirtyFields).filter(e=>{let[t,o]=e;return!!o}).length,{fiat:I,currency:H}=(0,n.fb0)({sc:D});return(0,a.jsx)(u.J,{title:"Autopilot",routes:d._,sidenav:(0,a.jsx)(l.e,{}),stats:W?(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(n.xvT,{size:"12",font:"mono",weight:"medium",children:"Estimate:"}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)(n.YKL,{size:"12",value:(0,m.qN)(D),dynamicUnits:!1,fixed:0,variant:"value"}),I&&(0,a.jsx)("div",{className:"flex",children:(0,a.jsx)(n.m2c,{size:"12",weight:"medium",value:I,color:"subtle",variant:"value",format:e=>"(".concat(H.prefix).concat(e.toFixed(H.fixed),")")})}),(0,a.jsxs)(n.xvT,{size:"12",font:"mono",weight:"medium",children:["per month to store ",(0,m.vW)((0,n.xf5)(F).toNumber())]})]})]}):(0,a.jsx)(n.xvT,{size:"12",font:"mono",weight:"medium",children:"Enter expected storage, period, and allowance values to estimate monthly spending."}),actions:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[!!z&&(0,a.jsx)(n.xvT,{size:"12",color:"subtle",children:1===z?"1 change":"".concat(z," changes")}),(0,a.jsx)(n.zxk,{tip:"Reset all changes",icon:"contrast",disabled:!z,onClick:C,children:(0,a.jsx)(n.Wet,{})}),(0,a.jsxs)(n.eQh,{children:[(0,a.jsxs)(n.zxk,{tip:"Save all changes",variant:"accent",disabled:!b.formState.isDirty||b.formState.isSubmitting,onClick:E,children:[(0,a.jsx)(n.ZEk,{}),"Save changes"]}),(0,a.jsx)(n.J2e,{contentProps:{align:"end"},trigger:(0,a.jsx)(n.zxk,{variant:"accent",icon:"hover",children:(0,a.jsx)(n.shL,{})}),children:(0,a.jsxs)("div",{className:"px-1",children:[(0,a.jsx)(n.__J,{children:"Options"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(n.q_s,{checked:s,onCheckedChange:e=>j(e),children:"sync default contract set"}),(0,a.jsx)(n.nvN,{size:"12",children:"Automatically update the default contract set to be the same as the autopilot contract set when changes are saved."})]})]})})]})]}),openSettings:()=>e("settings"),children:(0,a.jsxs)("div",{className:"px-5 py-6 flex flex-col gap-16 max-w-screen-xl",children:[(0,a.jsx)(n.vRO,{title:"Contracts",category:"contracts",fields:w,form:b}),(0,a.jsx)(n.vRO,{title:"Hosts",category:"hosts",fields:w,form:b}),(0,a.jsx)(n.vRO,{title:"Wallet",category:"wallet",fields:w,form:b})]})})}function T(){return(0,a.jsx)(j,{})}}},function(e){e.O(0,[189,774,888,179],function(){return e(e.s=98292)}),_N_E=e.O()}]);