(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[490],{57344:function(a,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/config",function(){return t(74782)}])},74782:function(a,e,t){"use strict";t.r(e),t.d(e,{default:function(){return x}});var r=t(52322),n=t(58422),s=t(2784),i=t(15755),o=t(74881),c=t(30650),d=t(16133),l=t(73621),u=t(20508),g=t(85246),f=t(63955),m=t(28031),p=t(2288),y=t(40121);let h="v0-config-display-options";function w(){let{openDialog:a}=(0,c.Rh)(),e=(0,y.a)({config:{swr:{revalidateOnFocus:!1,errorRetryCount:0}}}),t=(0,l.yu)({config:{swr:{revalidateOnFocus:!1}},params:{key:"gouging"}}),w=(0,l.yu)({config:{swr:{revalidateOnFocus:!1}},params:{key:"redundancy"}}),x=(0,l.yu)({config:{swr:{revalidateOnFocus:!1,errorRetryCount:0}},params:{key:h}}),v=(0,l.KJ)(),k=(0,m.BF)({config:{swr:{revalidateOnFocus:!1}}}),_=(0,f.cI)({mode:"all",defaultValues:u.Pg}),O=(0,s.useCallback)((a,e,t,r)=>{_.reset((0,g.IP)(a,e,t,r))},[_]),[S,j]=(0,s.useState)(!1);(0,s.useEffect)(()=>{t.data&&w.data&&(e.data||e.error)&&(x.data||x.error)&&!S&&(O(e.data,t.data,w.data,x.data),j(!0))},[e.data,e.error,t.data,w.data,x.data,x.error]);let b=(0,s.useCallback)(async()=>{let a=await e.mutate(),r=await t.mutate(),s=await w.mutate(),i=await x.mutate();r&&s?O(a,r,s,i):(0,n.OHV)("Error fetching settings.")},[e,t,w,x,O]),C=_.watch("minShards"),E=_.watch("totalShards"),N=_.watch("includeRedundancyMaxStoragePrice"),R=_.watch("includeRedundancyMaxUploadPrice"),F=(0,s.useMemo)(()=>{let a=(0,g.aU)(C,E);return k.data?(0,u.VN)({redundancyMultiplier:a,includeRedundancyMaxStoragePrice:N,includeRedundancyMaxUploadPrice:R,storageAverage:(0,p.ll)(k.data.settings.storage_price).times((0,n.S5V)(1)).times((0,n.xf5)(1)).times((0,g.Si)(C,E,N)),uploadAverage:(0,p.ll)(k.data.settings.upload_price).times((0,n.xf5)(1)).times((0,g.Si)(C,E,R)),downloadAverage:(0,p.ll)(k.data.settings.download_price).times((0,n.xf5)(1)),contractAverage:(0,p.ll)(k.data.settings.contract_price)}):(0,u.VN)({redundancyMultiplier:a,includeRedundancyMaxStoragePrice:N,includeRedundancyMaxUploadPrice:R})},[k.data,C,E,N,R]),P=(0,s.useCallback)(async a=>{if(t.data&&w.data)try{let r=await v.put({params:{key:"contractset"},payload:(0,g.y4)(a,e.data)}),s=await v.put({params:{key:"gouging"},payload:(0,g.MN)(a,t.data)}),i=await v.put({params:{key:"redundancy"},payload:(0,g.Y$)(a,w.data)}),o=await v.put({params:{key:h},payload:(0,g.yz)(a,x.data)});if(r.error)throw Error(r.error);if(s.error)throw Error(s.error);if(i.error)throw Error(i.error);if(o.error)throw Error(o.error);(0,n.OPV)("Configuration has been saved."),b()}catch(c){(0,n.OHV)(c.message),console.log(c)}},[v,e,w,t,x,b]),V=(0,n.WsO)(F),M=(0,s.useMemo)(()=>_.handleSubmit(P,V),[_,P,V]),z=Object.entries(_.formState.dirtyFields).filter(a=>{let[e,t]=a;return!!t}).length;return(0,r.jsx)(d.J,{title:"Configuration",routes:o._,sidenav:(0,r.jsx)(i.e,{}),actions:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[!!z&&(0,r.jsx)(n.xvT,{size:"12",color:"subtle",children:1===z?"1 change":"".concat(z," changes")}),(0,r.jsx)(n.zxk,{tip:"Reset all changes",icon:"contrast",disabled:!z,onClick:b,children:(0,r.jsx)(n.Wet,{})}),(0,r.jsxs)(n.zxk,{tip:"Save all changes",variant:"accent",disabled:!_.formState.isDirty||_.formState.isSubmitting,onClick:M,children:[(0,r.jsx)(n.ZEk,{}),"Save changes"]})]}),openSettings:()=>a("settings"),children:(0,r.jsxs)("div",{className:"p-6 flex flex-col gap-16 max-w-screen-xl",children:[(0,r.jsx)(n.vRO,{title:"Contracts",category:"contractset",fields:F,form:_}),(0,r.jsx)(n.vRO,{title:"Gouging",category:"gouging",fields:F,form:_}),(0,r.jsx)(n.vRO,{title:"Redundancy",category:"redundancy",fields:F,form:_})]})})}function x(){return(0,r.jsx)(w,{})}}},function(a){a.O(0,[514,774,888,179],function(){return a(a.s=57344)}),_N_E=a.O()}]);