(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,913749,e=>{"use strict";var a=e.i(843476);e.i(387020);var t=e.i(339173),i=e.i(696542),s=e.i(1206),n=e.i(223216),l=e.i(630958),r=e.i(402627),o=e.i(320201),d=e.i(540491),u=e.i(653145),c=e.i(271645);e.i(587154);var m=e.i(699221);function x({heading:e,onClose:x,remoteValues:h,fields:f,onSave:g,actionsLeft:j,actionsRight:y,render:p}){let b=(0,u.useForm)({mode:"all"});(0,l.useFormInit)({form:b,remoteValues:h}),(0,r.useFormServerSynced)({form:b,remoteValues:h});let{changeCount:T}=(0,o.useFormChangeCount)({form:b}),v=T>0,S=(0,c.useCallback)(async e=>{await g(e),b.reset(e)},[g,b]),B=(0,n.useOnInvalid)(f);return(0,a.jsx)(d.SidePanel,{onClose:x,heading:e,onSubmit:b.handleSubmit(S,B),actions:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 w-full",children:[j,(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[v?(0,a.jsxs)(s.Text,{color:"subtle",size:"12",children:[T," change",1===T?"":"s"]}):null,(0,a.jsx)(t.Button,{onClick:()=>b.reset(h),variant:"ghost",disabled:!v,tip:"Reset all changes",children:(0,a.jsx)(m.Reset16,{})}),(0,a.jsx)(i.FormSubmitButton,{variant:b.formState.isDirty?"accent":"gray",size:"small",form:b,requireChanges:!0,children:(0,a.jsx)(m.Save16,{})})]}),y]}),children:p(b,f)})}e.s(["EditablePanel",()=>x])},245112,e=>{"use strict";var a=e.i(843476);e.i(387020);var t=e.i(217099),i=e.i(641331),s=e.i(226584),n=e.i(799163),l=e.i(926622),r=e.i(755337),o=e.i(271645),d=e.i(1206),u=e.i(865085),c=e.i(706141),m=e.i(74045),x=e.i(623923);let h=[(0,m.selectColumn)(),{id:"key",header:({table:e,column:t})=>(0,a.jsx)(c.TableHeader,{table:e,column:t,className:"justify-start",children:"Key"}),cell:({row:e})=>(0,a.jsx)(u.ValueCopyable,{maxLength:100,value:e.original.key,label:"key"}),meta:{className:"justify-start",...x.hashColumnWidth}},{id:"description",header:({table:e,column:t})=>(0,a.jsx)(c.TableHeader,{table:e,column:t,className:"justify-start",children:"Description"}),cell:({row:e})=>(0,a.jsx)(d.Text,{children:e.original.description}),meta:{className:"justify-start",...x.hashColumnWidth}},{id:"maxPinnedData",header:({table:e,column:t})=>(0,a.jsx)(c.TableHeader,{table:e,column:t,className:"justify-end",children:"Max pinned data"}),cell:({row:e})=>(0,a.jsx)(d.Text,{children:e.original.displayFields.maxPinnedData}),meta:{className:"justify-end",...x.smallColumnWidth}},{id:"totalUses",header:({table:e,column:t})=>(0,a.jsx)(c.TableHeader,{table:e,column:t,className:"justify-end",children:"Total uses"}),cell:({row:e})=>(0,a.jsx)(d.Text,{children:e.original.totalUses}),meta:{className:"justify-end",...x.smallColumnWidth}},{id:"fundTargetBytes",header:({table:e,column:t})=>(0,a.jsx)(c.TableHeader,{table:e,column:t,className:"justify-end",children:"Fund target"}),cell:({row:e})=>(0,a.jsx)(d.Text,{children:e.original.displayFields.fundTargetBytes}),meta:{className:"justify-end",...x.smallColumnWidth}}];var f=e.i(339173),g=e.i(540491);function j({table:e}){let t=(0,o.useMemo)(()=>e.isSelection?e.selectedRows:e.rows,[e.isSelection,e.selectedRows,e.rows]);return(0,a.jsx)(g.SidePanel,{heading:(0,a.jsx)(d.Text,{size:"18",weight:"medium",children:e.isSelection?`Selected quotas (${t.length})`:e.isFiltered?`Filtered quotas (${t.length})`:"All quotas"}),customCloseAction:e.isSelection?(0,a.jsx)(f.Button,{onClick:()=>e.setRowSelection({}),children:"Clear selection"}):null,children:(0,a.jsx)(d.Text,{color:"subtle",className:"flex justify-center pt-[50px]",children:"No information on quotas yet"})})}var y=e.i(530875),p=e.i(489842),b=e.i(877438),T=e.i(86330),v=e.i(33200),S=e.i(423836);e.i(587154);var B=e.i(699221),P=e.i(149329),C=e.i(750560);e.i(519977);var N=e.i(219474);e.i(563386);var D=e.i(455030);e.i(253894);var q=e.i(110094),k=e.i(913749),w=e.i(756894);e.i(913272);var F=e.i(608970),U=e.i(828073);function G(e){return{id:e.key,key:e.key,description:e.description,maxPinnedData:e.maxPinnedData,totalUses:e.totalUses,fundTargetBytes:e.fundTargetBytes,displayFields:{maxPinnedData:(0,F.humanBytes)(e.maxPinnedData),fundTargetBytes:(0,F.humanBytes)(e.fundTargetBytes)}}}new U.default(16).times(new U.default(2).pow(30).div(1e9));var R=e.i(929232);function Q(){let{panelId:e,setPanelId:t}=(0,P.useQuotasParams)(),{openDialog:i}=(0,S.useDialog)(),s=(0,N.useAdminQuotaUpdate)(),n=(0,D.useMutate)(),l=(0,N.useAdminQuota)({disabled:!e,params:{key:e}}),r=(0,o.useMemo)(()=>({description:{type:"text",title:"Description",placeholder:"Description",validation:{required:"required"}},maxPinnedDataGB:{type:"number",title:"Max pinned data",units:"GB",decimalsLimit:2,placeholder:"100",validation:{required:"required"}},totalUses:{type:"number",title:"Total uses",decimalsLimit:0,placeholder:"1000",validation:{required:"required"}},fundTargetGB:{type:"number",title:"Fund target",units:"GB",decimalsLimit:2,placeholder:"17.18",validation:{required:"required"}}}),[]),u=(0,y.useRemoteData)({adminQuota:l},({adminQuota:e})=>{let a,t;return t={description:(a=G(e)).description,maxPinnedDataGB:new U.default(a.maxPinnedData).div(1e9),totalUses:new U.default(a.totalUses),fundTargetGB:new U.default(a.fundTargetBytes).div(1e9)},{quota:a,values:t}}),c=(0,o.useCallback)(async e=>{if(!u.data)return;let a=await s.put({params:{key:u.data.quota.key},payload:{description:e.description,maxPinnedData:e.maxPinnedDataGB?e.maxPinnedDataGB.times(1e9).toNumber():0,totalUses:e.totalUses?e.totalUses.toNumber():0,fundTargetBytes:e.fundTargetGB?e.fundTargetGB.times(1e9).toNumber():0}});a.error?(0,v.triggerErrorToast)({title:"Error saving quota",body:a.error}):((0,v.triggerSuccessToast)({title:"Quota updated"}),await n(e=>e.startsWith(q.adminQuotasRoute)))},[s,n,u.data]);return(0,a.jsx)(p.RemoteDataStates,{data:u,loading:(0,a.jsx)(w.SidePanelSkeleton,{withActions:!0,onClose:()=>t(void 0)}),notFound:(0,a.jsx)(g.SidePanel,{heading:null,children:(0,a.jsx)("div",{className:"flex justify-center pt-[50px]",children:(0,a.jsx)(d.Text,{color:"subtle",children:"Quota not found"})})}),loaded:({quota:e,values:s})=>(0,a.jsx)(k.EditablePanel,{heading:(0,a.jsx)(C.SidePanelHeadingCopyable,{heading:"Quota",value:e.key,label:"key"}),onClose:()=>t(void 0),remoteValues:s,fields:r,onSave:c,actionsLeft:(0,a.jsx)(f.Button,{onClick:()=>i("quotaDelete",e.key),children:(0,a.jsx)(B.TrashCan16,{})}),render:(e,t)=>(0,a.jsx)(R.SidePanelSection,{heading:"Info",children:(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(b.FieldText,{name:"description",form:e,fields:t}),(0,a.jsx)(T.FieldNumber,{name:"maxPinnedDataGB",form:e,fields:t}),(0,a.jsx)(T.FieldNumber,{name:"totalUses",form:e,fields:t}),(0,a.jsx)(T.FieldNumber,{name:"fundTargetGB",form:e,fields:t})]})})},e.key)})}var A=e.i(367887),M=e.i(66084);function E(){let{openDialog:e}=(0,S.useDialog)();return(0,a.jsxs)(f.Button,{variant:"accent",onClick:()=>e("quotaCreate"),children:[(0,a.jsx)(B.Add16,{}),"Create quota"]})}function H(){let{offset:e,limit:d,setOffset:u,setLimit:c,panelId:m,setPanelId:x,columnFilters:f,setColumnFilters:g,columnSorts:y,setColumnSorts:p}=(0,P.useQuotasParams)(),b=(0,o.useCallback)(e=>{x(e)},[x]),T=function(){let{limit:e,offset:a}=(0,P.useQuotasParams)(),t=(0,N.useAdminQuotas)({params:{limit:e,offset:a}});return(0,A.useRemoteDataset)({quotas:t},({quotas:e})=>e.map(G),{offset:a})}(),v=(0,l.useDataTable)({dataset:T,columns:h,columnFilters:f,setColumnFilters:g,columnSorts:y,setColumnSorts:p,offset:e,limit:d,onRowClick:b,setOffset:u,setLimit:c});return(0,a.jsx)(M.Layout,{table:(0,a.jsx)(t.DataTable,{...v,localStorage:"indexd/quotas",actions:(0,a.jsx)(E,{}),noneOnPage:(0,a.jsx)(r.StateNoneOnPage,{message:"No quotas on this page, reset pagination to continue."}),noneYet:(0,a.jsx)(i.StateNoneYet,{message:"There are no quotas yet."}),noneMatchingFilters:(0,a.jsx)(n.StateNoneMatching,{message:"No quotas matching filters."}),error:(0,a.jsx)(s.StateError,{message:"Error loading quotas. Please try again later."})}),panel:m?(0,a.jsx)(Q,{}):(0,a.jsx)(j,{table:v})})}function L(){return(0,a.jsx)(H,{})}e.s(["default",()=>L],245112)}]);