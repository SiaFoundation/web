(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,913749,e=>{"use strict";var a=e.i(843476);e.i(387020);var t=e.i(339173),i=e.i(696542),s=e.i(1206),n=e.i(223216),l=e.i(630958),o=e.i(402627),r=e.i(320201),d=e.i(540491),u=e.i(653145),c=e.i(271645);e.i(587154);var m=e.i(699221);function x({heading:e,onClose:x,remoteValues:h,fields:j,onSave:g,actionsLeft:p,actionsRight:f,render:y}){let b=(0,u.useForm)({mode:"all"});(0,l.useFormInit)({form:b,remoteValues:h}),(0,o.useFormServerSynced)({form:b,remoteValues:h});let{changeCount:v}=(0,r.useFormChangeCount)({form:b}),S=v>0,P=(0,c.useCallback)(async e=>{await g(e),b.reset(e)},[g,b]),C=(0,n.useOnInvalid)(j);return(0,a.jsx)(d.SidePanel,{onClose:x,heading:e,onSubmit:b.handleSubmit(P,C),actions:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 w-full",children:[p,(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[S?(0,a.jsxs)(s.Text,{color:"subtle",size:"12",children:[v," change",1===v?"":"s"]}):null,(0,a.jsx)(t.Button,{onClick:()=>b.reset(h),variant:"ghost",disabled:!S,tip:"Reset all changes",children:(0,a.jsx)(m.Reset16,{})}),(0,a.jsx)(i.FormSubmitButton,{variant:b.formState.isDirty?"accent":"gray",size:"small",form:b,requireChanges:!0,children:(0,a.jsx)(m.Save16,{})})]}),f]}),children:y(b,j)})}e.s(["EditablePanel",()=>x])},245112,e=>{"use strict";var a=e.i(843476);e.i(387020);var t=e.i(217099),i=e.i(641331),s=e.i(226584),n=e.i(799163),l=e.i(926622),o=e.i(755337),r=e.i(271645),d=e.i(1206),u=e.i(865085),c=e.i(706141),m=e.i(74045),x=e.i(623923);let h=[(0,m.selectColumn)(),{id:"key",header:({table:e,column:t})=>(0,a.jsx)(c.TableHeader,{table:e,column:t,className:"justify-start",children:"Key"}),cell:({row:e})=>(0,a.jsx)(u.ValueCopyable,{maxLength:100,value:e.original.key,label:"key"}),meta:{className:"justify-start",...x.hashColumnWidth}},{id:"description",header:({table:e,column:t})=>(0,a.jsx)(c.TableHeader,{table:e,column:t,className:"justify-start",children:"Description"}),cell:({row:e})=>(0,a.jsx)(d.Text,{children:e.original.description}),meta:{className:"justify-start",...x.hashColumnWidth}},{id:"maxPinnedData",header:({table:e,column:t})=>(0,a.jsx)(c.TableHeader,{table:e,column:t,className:"justify-end",children:"Max pinned data"}),cell:({row:e})=>(0,a.jsx)(d.Text,{children:e.original.displayFields.maxPinnedData}),meta:{className:"justify-end",...x.smallColumnWidth}},{id:"totalUses",header:({table:e,column:t})=>(0,a.jsx)(c.TableHeader,{table:e,column:t,className:"justify-end",children:"Total uses"}),cell:({row:e})=>(0,a.jsx)(d.Text,{children:e.original.totalUses}),meta:{className:"justify-end",...x.smallColumnWidth}}];var j=e.i(339173),g=e.i(540491);function p({table:e}){let t=(0,r.useMemo)(()=>e.isSelection?e.selectedRows:e.rows,[e.isSelection,e.selectedRows,e.rows]);return(0,a.jsx)(g.SidePanel,{heading:(0,a.jsx)(d.Text,{size:"18",weight:"medium",children:e.isSelection?`Selected quotas (${t.length})`:e.isFiltered?`Filtered quotas (${t.length})`:"All quotas"}),customCloseAction:e.isSelection?(0,a.jsx)(j.Button,{onClick:()=>e.setRowSelection({}),children:"Clear selection"}):null,children:(0,a.jsx)(d.Text,{color:"subtle",className:"flex justify-center pt-[50px]",children:"No information on quotas yet"})})}var f=e.i(530875),y=e.i(489842),b=e.i(877438),v=e.i(86330),S=e.i(33200),P=e.i(423836);e.i(587154);var C=e.i(699221),D=e.i(149329),T=e.i(750560);e.i(519977);var N=e.i(219474);e.i(563386);var k=e.i(455030);e.i(253894);var q=e.i(110094),w=e.i(913749),B=e.i(756894);e.i(913272);var F=e.i(608970),U=e.i(828073);function R(e){return{id:e.key,key:e.key,description:e.description,maxPinnedData:e.maxPinnedData,totalUses:e.totalUses,displayFields:{maxPinnedData:(0,F.humanBytes)(e.maxPinnedData)}}}var Q=e.i(929232);function A(){let{panelId:e,setPanelId:t}=(0,D.useQuotasParams)(),{openDialog:i}=(0,P.useDialog)(),s=(0,N.useAdminQuotaUpdate)(),n=(0,k.useMutate)(),l=(0,N.useAdminQuota)({disabled:!e,params:{key:e}}),o=(0,r.useMemo)(()=>({description:{type:"text",title:"Description",placeholder:"Description",validation:{required:"required"}},maxPinnedDataGB:{type:"number",title:"Max pinned data",units:"GB",decimalsLimit:2,placeholder:"100",validation:{required:"required"}},totalUses:{type:"number",title:"Total uses",decimalsLimit:0,placeholder:"1000",validation:{required:"required"}}}),[]),u=(0,f.useRemoteData)({adminQuota:l},({adminQuota:e})=>{let a,t;return t={description:(a=R(e)).description,maxPinnedDataGB:new U.default(a.maxPinnedData).div(1e9),totalUses:new U.default(a.totalUses)},{quota:a,values:t}}),c=(0,r.useCallback)(async e=>{if(!u.data)return;let a=await s.put({params:{key:u.data.quota.key},payload:{description:e.description,maxPinnedData:e.maxPinnedDataGB?e.maxPinnedDataGB.times(1e9).toNumber():0,totalUses:e.totalUses?e.totalUses.toNumber():0}});a.error?(0,S.triggerErrorToast)({title:"Error saving quota",body:a.error}):((0,S.triggerSuccessToast)({title:"Quota updated"}),await n(e=>e.startsWith(q.adminQuotasRoute)))},[s,n,u.data]);return(0,a.jsx)(y.RemoteDataStates,{data:u,loading:(0,a.jsx)(B.SidePanelSkeleton,{withActions:!0,onClose:()=>t(void 0)}),notFound:(0,a.jsx)(g.SidePanel,{heading:null,children:(0,a.jsx)("div",{className:"flex justify-center pt-[50px]",children:(0,a.jsx)(d.Text,{color:"subtle",children:"Quota not found"})})}),loaded:({quota:e,values:s})=>(0,a.jsx)(w.EditablePanel,{heading:(0,a.jsx)(T.SidePanelHeadingCopyable,{heading:"Quota",value:e.key,label:"key"}),onClose:()=>t(void 0),remoteValues:s,fields:o,onSave:c,actionsLeft:(0,a.jsx)(j.Button,{onClick:()=>i("quotaDelete",e.key),children:(0,a.jsx)(C.TrashCan16,{})}),render:(e,t)=>(0,a.jsx)(Q.SidePanelSection,{heading:"Info",children:(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(b.FieldText,{name:"description",form:e,fields:t}),(0,a.jsx)(v.FieldNumber,{name:"maxPinnedDataGB",form:e,fields:t}),(0,a.jsx)(v.FieldNumber,{name:"totalUses",form:e,fields:t})]})})},e.key)})}var M=e.i(367887),E=e.i(66084);function G(){let{openDialog:e}=(0,P.useDialog)();return(0,a.jsxs)(j.Button,{variant:"accent",onClick:()=>e("quotaCreate"),children:[(0,a.jsx)(C.Add16,{}),"Create quota"]})}function H(){let{offset:e,limit:d,setOffset:u,setLimit:c,panelId:m,setPanelId:x,columnFilters:j,setColumnFilters:g,columnSorts:f,setColumnSorts:y}=(0,D.useQuotasParams)(),b=(0,r.useCallback)(e=>{x(e)},[x]),v=function(){let{limit:e,offset:a}=(0,D.useQuotasParams)(),t=(0,N.useAdminQuotas)({params:{limit:e,offset:a}});return(0,M.useRemoteDataset)({quotas:t},({quotas:e})=>e.map(R),{offset:a})}(),S=(0,l.useDataTable)({dataset:v,columns:h,columnFilters:j,setColumnFilters:g,columnSorts:f,setColumnSorts:y,offset:e,limit:d,onRowClick:b,setOffset:u,setLimit:c});return(0,a.jsx)(E.Layout,{table:(0,a.jsx)(t.DataTable,{...S,localStorage:"indexd/quotas",actions:(0,a.jsx)(G,{}),noneOnPage:(0,a.jsx)(o.StateNoneOnPage,{message:"No quotas on this page, reset pagination to continue."}),noneYet:(0,a.jsx)(i.StateNoneYet,{message:"There are no quotas yet."}),noneMatchingFilters:(0,a.jsx)(n.StateNoneMatching,{message:"No quotas matching filters."}),error:(0,a.jsx)(s.StateError,{message:"Error loading quotas. Please try again later."})}),panel:m?(0,a.jsx)(A,{}):(0,a.jsx)(p,{table:S})})}function L(){return(0,a.jsx)(H,{})}e.s(["default",()=>L],245112)}]);